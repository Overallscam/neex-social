<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NEEX Debug</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body { background: #000; color: #fff; font-family: Arial; padding: 20px; }
    .container { max-width: 400px; margin: 0 auto; text-align: center; }
    input { width: 100%; padding: 10px; margin: 10px 0; background: #222; border: 1px solid #333; color: #fff; border-radius: 5px; }
    button { width: 100%; padding: 10px; background: #1d9bf0; color: white; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #1a8cd8; }
    .error { color: #ff6b6b; margin: 10px 0; }
    .success { color: #51cf66; margin: 10px 0; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;

    function App() {
      const [loginForm, setLoginForm] = useState({ username: '', password: '' });
      const [loggedIn, setLoggedIn] = useState(false);
      const [currentUser, setCurrentUser] = useState(null);
      const [message, setMessage] = useState('');
      const [loading, setLoading] = useState(false);

      const API_BASE_URL = 'https://neex-social-production.up.railway.app';

      const handleLogin = async (e) => {
        e.preventDefault();
        setLoading(true);
        setMessage('Connecting to backend...');

        try {
          const response = await fetch(`${API_BASE_URL}/login`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(loginForm),
          });

          const data = await response.json();

          if (response.ok) {
            setCurrentUser(data.user);
            setLoggedIn(true);
            setMessage(`‚úÖ Welcome ${data.user.name}!`);
          } else {
            setMessage(`‚ùå ${data.message || 'Login failed'}`);
          }
        } catch (error) {
          console.error('Login error:', error);
          setMessage(`‚ùå Connection error: ${error.message}`);
        } finally {
          setLoading(false);
        }
      };

      const testConnection = async () => {
        setLoading(true);
        setMessage('Testing backend connection...');
        
        try {
          const response = await fetch(`${API_BASE_URL}/`);
          const data = await response.json();
          setMessage(`‚úÖ Backend connected! Database: ${data.database.current}`);
        } catch (error) {
          setMessage(`‚ùå Backend connection failed: ${error.message}`);
        } finally {
          setLoading(false);
        }
      };

      if (loggedIn) {
        return (
          <div className="container">
            <h1>üöÄ NEEX Debug - Logged In</h1>
            <div className="success">Welcome {currentUser.name}!</div>
            <p>User ID: {currentUser.id}</p>
            <p>Username: {currentUser.username}</p>
            <button onClick={() => setLoggedIn(false)}>Logout</button>
          </div>
        );
      }

      return (
        <div className="container">
          <h1>üöÄ NEEX Debug Login</h1>
          
          <button onClick={testConnection} disabled={loading}>
            Test Backend Connection
          </button>
          
          <form onSubmit={handleLogin}>
            <input
              type="text"
              placeholder="Username (try: testuser)"
              value={loginForm.username}
              onChange={(e) => setLoginForm({...loginForm, username: e.target.value})}
            />
            <input
              type="password"
              placeholder="Password (try: password123)"
              value={loginForm.password}
              onChange={(e) => setLoginForm({...loginForm, password: e.target.value})}
            />
            <button type="submit" disabled={loading}>
              {loading ? 'Loading...' : 'Login'}
            </button>
          </form>
          
          <div className={message.includes('‚úÖ') ? 'success' : 'error'}>
            {message}
          </div>
          
          <div style={{marginTop: '20px', fontSize: '12px', color: '#666'}}>
            This debug version tests the Firebase backend connection
          </div>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
